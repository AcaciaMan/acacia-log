<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; font-src {{CSP_SOURCE}}; style-src {{CSP_SOURCE}} 'unsafe-inline'; script-src 'unsafe-inline';">
  <title>Log Manager</title>
  <link href="{{CODICONS_URI}}" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--vscode-font-family);
      font-size: var(--vscode-font-size);
      color: var(--vscode-editor-foreground);
      background-color: var(--vscode-editor-background);
      padding: 0;
      line-height: 1.5;
      overflow-x: hidden;
    }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      border-bottom: 1px solid var(--vscode-panel-border);
      background-color: var(--vscode-editor-background);
    }

    .panel-title {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .active-file-display {
      font-size: 12px;
      color: var(--vscode-descriptionForeground);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 400px;
    }

    /* ‚îÄ‚îÄ Tab Navigation ‚îÄ‚îÄ */
    .tab-nav {
      display: flex;
      flex-wrap: wrap;
      background-color: var(--vscode-editorGroupHeader-tabsBackground, var(--vscode-editor-background));
      border-bottom: 1px solid var(--vscode-panel-border);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .tab-button {
      flex: 1 1 0;
      min-width: 0;
      padding: 8px 8px;
      background-color: transparent;
      color: var(--vscode-tab-inactiveForeground, var(--vscode-descriptionForeground));
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
      font-size: 12px;
      font-family: var(--vscode-font-family);
      font-weight: 500;
      transition: all 0.15s;
      outline: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tab-button:hover {
      color: var(--vscode-editor-foreground);
      background-color: var(--vscode-tab-hoverBackground, rgba(255,255,255,0.05));
    }

    .tab-button.active {
      color: var(--vscode-editor-foreground);
      border-bottom-color: var(--vscode-focusBorder, #007acc);
      background-color: var(--vscode-tab-activeBackground, var(--vscode-editor-background));
    }

    .tab-button:focus-visible {
      outline: 1px solid var(--vscode-focusBorder);
      outline-offset: -1px;
    }

    .tab-icon { font-size: 13px; }

    /* ‚îÄ‚îÄ Tab Content ‚îÄ‚îÄ */
    .tab-content {
      display: none;
      padding: 16px;
      max-width: 800px;
      animation: fadeIn 0.15s ease-in;
    }

    .tab-content.active { display: block; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* ‚îÄ‚îÄ Typography ‚îÄ‚îÄ */
    h1 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--vscode-editor-foreground);
      border-bottom: 1px solid var(--vscode-panel-border);
      padding-bottom: 8px;
    }

    h2 {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--vscode-editor-foreground);
    }

    /* ‚îÄ‚îÄ Sections ‚îÄ‚îÄ */
    .section {
      background-color: var(--vscode-editor-inactiveSelectionBackground, rgba(255,255,255,0.04));
      border: 1px solid var(--vscode-panel-border);
      border-radius: 4px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
      margin-bottom: 8px;
    }

    .section-title { font-size: 13px; font-weight: 600; color: var(--vscode-editor-foreground); }
    .section-toggle { font-size: 12px; color: var(--vscode-descriptionForeground); transition: transform 0.2s; }
    .section.collapsed .section-toggle { transform: rotate(-90deg); }
    .section.collapsed .section-content { display: none; }

    /* ‚îÄ‚îÄ Forms ‚îÄ‚îÄ */
    .form-group { margin-bottom: 10px; }
    .form-group:last-child { margin-bottom: 0; }

    label {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
      font-size: 12px;
      font-weight: 500;
      color: var(--vscode-editor-foreground);
    }

    .help-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 14px;
      height: 14px;
      margin-left: 6px;
      border-radius: 50%;
      background-color: var(--vscode-button-secondaryBackground);
      color: var(--vscode-button-secondaryForeground);
      font-size: 10px;
      cursor: help;
      font-weight: bold;
    }

    .help-text {
      font-size: 11px;
      color: var(--vscode-descriptionForeground);
      margin-top: 3px;
      padding: 4px 8px;
      background-color: var(--vscode-textCodeBlock-background);
      border-radius: 3px;
      display: none;
    }

    .help-text.visible { display: block; }

    input[type="text"],
    input[type="date"],
    input[type="time"],
    input[type="number"],
    select {
      width: 100%;
      padding: 5px 8px;
      background-color: var(--vscode-input-background);
      color: var(--vscode-input-foreground);
      border: 1px solid var(--vscode-input-border, var(--vscode-panel-border));
      border-radius: 3px;
      font-family: var(--vscode-font-family);
      font-size: 12px;
      outline: none;
      transition: border-color 0.15s;
    }

    input:focus, select:focus { border-color: var(--vscode-focusBorder); }
    input::placeholder { color: var(--vscode-input-placeholderForeground); }
    select { cursor: pointer; margin-top: 4px; }

    input[type="checkbox"] {
      width: auto;
      margin-right: 6px;
      accent-color: var(--vscode-focusBorder);
    }

    .input-group {
      display: flex;
      gap: 6px;
      align-items: flex-start;
    }

    .input-group input { flex: 1; }

    .browse-btn {
      padding: 5px 10px;
      background-color: var(--vscode-button-secondaryBackground);
      color: var(--vscode-button-secondaryForeground);
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      white-space: nowrap;
      transition: background-color 0.15s;
    }

    .browse-btn:hover { background-color: var(--vscode-button-secondaryHoverBackground); }

    .date-time-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    @media (max-width: 400px) {
      .date-time-group { grid-template-columns: 1fr; }
    }

    /* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
    button {
      width: 100%;
      padding: 7px 14px;
      background-color: var(--vscode-button-background);
      color: var(--vscode-button-foreground);
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      font-family: var(--vscode-font-family);
      font-weight: 500;
      transition: background-color 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    button:hover:not(:disabled) { background-color: var(--vscode-button-hoverBackground); }
    button:active:not(:disabled) { opacity: 0.9; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    .secondary-btn {
      background-color: var(--vscode-button-secondaryBackground);
      color: var(--vscode-button-secondaryForeground);
    }

    .secondary-btn:hover:not(:disabled) { background-color: var(--vscode-button-secondaryHoverBackground); }

    .actions { margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--vscode-panel-border); }
    .primary-action { margin-bottom: 8px; }

    .quick-actions {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }

    .quick-action-btn {
      flex: 1;
      padding: 5px 10px;
      font-size: 11px;
      background-color: var(--vscode-button-secondaryBackground);
      color: var(--vscode-button-secondaryForeground);
      border: 1px solid var(--vscode-panel-border);
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .quick-action-btn:hover {
      background-color: var(--vscode-button-secondaryHoverBackground);
      border-color: var(--vscode-focusBorder);
    }

    /* ‚îÄ‚îÄ Spinner ‚îÄ‚îÄ */
    .spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid var(--vscode-button-foreground);
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ Status Messages ‚îÄ‚îÄ */
    .status-message {
      margin-top: 8px;
      padding: 6px 10px;
      border-radius: 3px;
      font-size: 12px;
      display: none;
    }

    .status-message.visible { display: block; }
    .status-message.success { background-color: var(--vscode-testing-iconPassed, #73c991); color: var(--vscode-editor-background); }
    .status-message.error { background-color: var(--vscode-testing-iconFailed, #f48771); color: var(--vscode-editor-background); }
    .status-message.info { background-color: var(--vscode-textLink-foreground, #007acc); color: var(--vscode-editor-background); }

    .info-box {
      margin-bottom: 12px;
      padding: 8px 10px;
      background-color: var(--vscode-textBlockQuote-background);
      border-left: 3px solid var(--vscode-textLink-foreground);
      border-radius: 3px;
      font-size: 12px;
      color: var(--vscode-descriptionForeground);
    }

    .result-info {
      margin-top: 16px;
      padding: 12px;
      background-color: var(--vscode-textBlockQuote-background);
      border-left: 3px solid var(--vscode-textLink-foreground, #007acc);
      border-radius: 3px;
      font-size: 12px;
    }

    .result-info-title { font-weight: 600; margin-bottom: 4px; }
    .result-info-text { color: var(--vscode-descriptionForeground); line-height: 1.6; }

    /* ‚îÄ‚îÄ Dashboard Cards ‚îÄ‚îÄ */
    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
      margin-bottom: 14px;
    }

    .stat-card {
      background-color: var(--vscode-editor-inactiveSelectionBackground, rgba(255,255,255,0.04));
      border: 1px solid var(--vscode-panel-border);
      border-radius: 6px;
      padding: 12px;
      text-align: center;
    }

    .stat-card-label {
      font-size: 11px;
      color: var(--vscode-descriptionForeground);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .stat-card-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--vscode-editor-foreground);
    }

    .stat-card-value .dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 4px;
      vertical-align: middle;
    }

    .dot-green { background-color: var(--vscode-testing-iconPassed, #73c991); }
    .dot-red { background-color: var(--vscode-testing-iconFailed, #f48771); }

    .quick-actions-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 8px;
      margin-bottom: 14px;
    }

    .quick-actions-dashboard button {
      padding: 10px 12px;
      font-size: 12px;
    }

    .recent-activity {
      padding: 14px;
      background-color: var(--vscode-editor-inactiveSelectionBackground, rgba(255,255,255,0.04));
      border: 1px solid var(--vscode-panel-border);
      border-radius: 6px;
      color: var(--vscode-descriptionForeground);
      font-size: 12px;
      margin-top: 8px;
    }

    .activity-item {
      padding: 4px 0;
      border-bottom: 1px solid var(--vscode-panel-border);
    }
    .activity-item:last-child {
      border-bottom: none;
    }

    /* ‚îÄ‚îÄ File Info Table ‚îÄ‚îÄ */
    .file-info-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    .file-info-table tr { border-bottom: 1px solid var(--vscode-panel-border); }
    .file-info-table tr:last-child { border-bottom: none; }
    .file-info-table td { padding: 7px 8px; }
    .file-info-table td:first-child { font-weight: 600; width: 140px; color: var(--vscode-descriptionForeground); }
    .file-info-table td:last-child { word-break: break-all; }

    /* ‚îÄ‚îÄ Compare Stats: File chips ‚îÄ‚îÄ */
    .file-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 8px 0;
      min-height: 32px;
      padding: 8px;
      background-color: var(--vscode-input-background);
      border: 1px solid var(--vscode-input-border, var(--vscode-panel-border));
      border-radius: 3px;
    }

    .file-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      background-color: var(--vscode-badge-background, #4d4d4d);
      color: var(--vscode-badge-foreground, #fff);
      border-radius: 12px;
      font-size: 11px;
      max-width: 220px;
    }

    .file-chip-name {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .file-chip-remove {
      cursor: pointer;
      font-size: 13px;
      line-height: 1;
      opacity: 0.7;
      transition: opacity 0.15s;
      background: none;
      border: none;
      color: inherit;
      padding: 0;
      width: auto;
      display: inline;
    }

    .file-chip-remove:hover { opacity: 1; }

    .empty-chips {
      color: var(--vscode-descriptionForeground);
      font-size: 12px;
      padding: 4px;
    }

    /* ‚îÄ‚îÄ JSONL Conversion toggle ‚îÄ‚îÄ */
    .toggle-group {
      display: flex;
      border: 1px solid var(--vscode-panel-border);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .toggle-btn {
      flex: 1;
      padding: 8px 12px;
      background-color: var(--vscode-button-secondaryBackground);
      color: var(--vscode-button-secondaryForeground);
      border: none;
      border-right: 1px solid var(--vscode-panel-border);
      cursor: pointer;
      font-size: 12px;
      font-family: var(--vscode-font-family);
      font-weight: 500;
      transition: all 0.15s;
      border-radius: 0;
    }

    .toggle-btn:last-child { border-right: none; }

    .toggle-btn.active {
      background-color: var(--vscode-button-background);
      color: var(--vscode-button-foreground);
    }

    .toggle-btn:hover:not(.active) {
      background-color: var(--vscode-button-secondaryHoverBackground);
    }

    .conversion-section { display: none; }
    .conversion-section.active { display: block; }

    /* ‚îÄ‚îÄ File Info action row ‚îÄ‚îÄ */
    .action-buttons-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }

    .action-buttons-row button { font-size: 12px; }

    /* ‚îÄ‚îÄ Empty state ‚îÄ‚îÄ */
    .empty-state {
      text-align: center;
      padding: 24px 16px;
      color: var(--vscode-descriptionForeground);
    }

    .empty-state-icon { font-size: 36px; margin-bottom: 8px; }
    .empty-state-text { font-size: 12px; }

    /* ‚îÄ‚îÄ Checkbox label ‚îÄ‚îÄ */
    .checkbox-label {
      display: flex;
      align-items: center;
      font-size: 12px;
      font-weight: normal;
      cursor: pointer;
      margin-bottom: 8px;
    }

    .checkbox-label input[type="checkbox"] { margin-right: 6px; }

    /* ‚îÄ‚îÄ Scrollbar ‚îÄ‚îÄ */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--vscode-scrollbarSlider-background); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--vscode-scrollbarSlider-hoverBackground); }

    .codicon {
      font-size: 14px;
      line-height: 1;
      vertical-align: middle;
    }

    .tab-icon .codicon {
      font-size: 13px;
    }

    h1 .codicon {
      font-size: 16px;
      margin-right: 4px;
    }

    .status-icon-pass { color: var(--vscode-testing-iconPassed, #73c991); }
    .status-icon-fail { color: var(--vscode-testing-iconFailed, #f48771); }

    button:focus-visible,
    input:focus-visible,
    select:focus-visible,
    .section-header:focus-visible,
    .help-icon:focus-visible,
    .file-chip-remove:focus-visible {
      outline: 2px solid var(--vscode-focusBorder);
      outline-offset: 1px;
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="panel-header" role="banner">
    <span class="panel-title"><span class="codicon codicon-list-filter"></span> Log Manager</span>
    <span class="active-file-display" id="headerActiveFile">No active file</span>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-nav" role="tablist" aria-label="Log Manager tabs">
    <button id="tab-dashboard" class="tab-button active" data-tab="dashboard" onclick="switchTab('dashboard')" role="tab" aria-selected="true" aria-controls="dashboardTab" tabindex="0" title="Dashboard">
      <span class="tab-icon"><span class="codicon codicon-dashboard"></span></span> Dashboard
    </button>
    <button id="tab-logSearch" class="tab-button" data-tab="logSearch" onclick="switchTab('logSearch')" role="tab" aria-selected="false" aria-controls="logSearchTab" tabindex="-1" title="Log Search">
      <span class="tab-icon"><span class="codicon codicon-search"></span></span> Log Search
    </button>
    <button id="tab-patternSearch" class="tab-button" data-tab="patternSearch" onclick="switchTab('patternSearch')" role="tab" aria-selected="false" aria-controls="patternSearchTab" tabindex="-1" title="Pattern Search">
      <span class="tab-icon"><span class="codicon codicon-list-filter"></span></span> Pattern Search
    </button>
    <button id="tab-similarLines" class="tab-button" data-tab="similarLines" onclick="switchTab('similarLines')" role="tab" aria-selected="false" aria-controls="similarLinesTab" tabindex="-1" title="Similar Lines">
      <span class="tab-icon"><span class="codicon codicon-group-by-ref-type"></span></span> Similar Lines
    </button>
    <button id="tab-timeline" class="tab-button" data-tab="timeline" onclick="switchTab('timeline')" role="tab" aria-selected="false" aria-controls="timelineTab" tabindex="-1" title="Timeline">
      <span class="tab-icon"><span class="codicon codicon-graph-line"></span></span> Timeline
    </button>
    <button id="tab-fileInfo" class="tab-button" data-tab="fileInfo" onclick="switchTab('fileInfo')" role="tab" aria-selected="false" aria-controls="fileInfoTab" tabindex="-1" title="File Info">
      <span class="tab-icon"><span class="codicon codicon-info"></span></span> File Info
    </button>
    <button id="tab-compareChunkStats" class="tab-button" data-tab="compareChunkStats" onclick="switchTab('compareChunkStats')" role="tab" aria-selected="false" aria-controls="compareChunkStatsTab" tabindex="-1" title="Compare Chunk Stats">
      <span class="tab-icon"><span class="codicon codicon-diff"></span></span> Compare Stats
    </button>
    <button id="tab-jsonlConversion" class="tab-button" data-tab="jsonlConversion" onclick="switchTab('jsonlConversion')" role="tab" aria-selected="false" aria-controls="jsonlConversionTab" tabindex="-1" title="JSONL Conversion">
      <span class="tab-icon"><span class="codicon codicon-arrow-swap"></span></span> JSONL
    </button>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- Shared Format Configuration (visible on logSearch, similarLines, timeline tabs) -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="section" id="sharedFormatConfig" style="display: none; margin: 0 16px;">
    <div class="section-header" role="button" tabindex="0" aria-expanded="true" aria-controls="sharedFormatConfigContent" onclick="toggleSection('sharedFormatConfig')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleSection('sharedFormatConfig')}">
      <span class="section-title"><span class="codicon codicon-settings-gear"></span> Log Format</span>
      <span class="section-toggle">‚ñº</span>
    </div>
    <div class="section-content" id="sharedFormatConfigContent">
      <div class="form-group">
        <label for="logTimeRegex">
          Date/Time Regex
          <span class="help-icon" role="button" tabindex="0" aria-expanded="false" aria-controls="regexHelp" aria-label="Help for Date/Time Regex" onclick="toggleHelp('regexHelp', event)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleHelp('regexHelp',event)}"><span class="codicon codicon-question"></span></span>
        </label>
        <div id="regexHelp" class="help-text" role="note">Regular expression to match date/time stamps in your log files. Select a preset or enter a custom pattern.</div>
        <input type="text" id="logTimeRegex" placeholder="e.g., \d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}" aria-label="Date time regex pattern">
        <select id="logTimeRegexSelect" aria-label="Preset regex patterns">
          <option value="">-- Select preset --</option>
          <option value="\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}">üìÖ Standard (yyyy-MM-dd HH:mm:ss)</option>
          <option value="\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|[+-]\d{2}:\d{2})">üåê ISO 8601</option>
          <option value="\d{2}/\w{3}/\d{4}:\d{2}:\d{2}:\d{2} [+-]\d{4}">üåê Common Log</option>
          <option value="\[\d{2}/\w{3}/\d{4}:\d{2}:\d{2}:\d{2} [+-]\d{4}\]">üîß Apache</option>
          <option value="\w{3} \d{2} \d{2}:\d{2}:\d{2}">üíª Syslog</option>
          <option value="\d{10}">‚è±Ô∏è UNIX Timestamp</option>
          <option value="\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3}">ü™ü Windows Event</option>
          <option value="\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2},\d{3}">‚òï Log4j</option>
        </select>
      </div>

      <div class="form-group">
        <label for="logTimeFormat">
          Date/Time Format
          <span class="help-icon" role="button" tabindex="0" aria-expanded="false" aria-controls="formatHelp" aria-label="Help for Date/Time Format" onclick="toggleHelp('formatHelp', event)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleHelp('formatHelp',event)}"><span class="codicon codicon-question"></span></span>
        </label>
        <div id="formatHelp" class="help-text" role="note">Format string for parsing matched date/time stamps (Luxon tokens).</div>
        <input type="text" id="logTimeFormat" placeholder="e.g., yyyy-MM-dd HH:mm:ss" aria-label="Date time format string">
        <select id="logTimeFormatSelect" aria-label="Preset format strings">
          <option value="">-- Select preset --</option>
          <option value="yyyy-MM-dd HH:mm:ss">üìÖ Standard</option>
          <option value="yyyy-MM-dd'T'HH:mm:ss.SSSXXX">üåê ISO 8601</option>
          <option value="dd/MMM/yyyy:HH:mm:ss Z">üåê Common Log</option>
          <option value="[dd/MMM/yyyy:HH:mm:ss Z]">üîß Apache</option>
          <option value="MMM dd HH:mm:ss">üíª Syslog</option>
          <option value="X">‚è±Ô∏è UNIX Timestamp</option>
          <option value="yyyy-MM-dd HH:mm:ss.SSS">ü™ü Windows Event</option>
          <option value="yyyy-MM-dd HH:mm:ss,SSS">‚òï Log4j</option>
        </select>
      </div>

      <div class="form-group">
        <button id="autoDetectButton" class="secondary-btn" aria-label="Auto-detect timestamp format">
          <span class="codicon codicon-lightbulb-autofix"></span> Auto-Detect Timestamp Format
        </button>
        <div id="autoDetectStatus" class="status-message" role="status" aria-live="polite" aria-atomic="true"></div>
      </div>

      <div class="form-group">
        <button type="button" class="secondary-btn" aria-label="Test regex pattern" onclick="testRegex()">
          <span class="codicon codicon-beaker"></span> Test Regex Pattern
        </button>
        <div id="regexTestResult" class="status-message" role="status" aria-live="polite" aria-atomic="true"></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- Tab 1: Dashboard                                               -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <main>
  <div class="tab-content active" id="dashboardTab" role="tabpanel" aria-labelledby="tab-dashboard">
    <h1><span class="codicon codicon-dashboard"></span> Dashboard</h1>

    <div class="section" id="activeFileSection">
      <h2>Active File</h2>
      <div id="dashboardActiveFile" style="font-size: 13px; word-break: break-all;">No active file</div>
    </div>

    <div class="dashboard-cards" id="dashboardCards">
      <div class="stat-card">
        <div class="stat-card-label">File Size</div>
        <div class="stat-card-value" id="dashFileSize">‚Äî</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-label">Line Count</div>
        <div class="stat-card-value" id="dashLineCount">‚Äî</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-label">Timestamp</div>
        <div class="stat-card-value" id="dashTimestamp"><span class="dot dot-red"></span> None</div>
      </div>
    </div>

    <div id="largeFileWarning" class="status-message error" style="display: none; margin-bottom: 12px;" role="alert">
      <span class="codicon codicon-warning"></span> Large file detected ‚Äî some operations may be slow.
    </div>

    <h2>Quick Actions</h2>
    <div class="quick-actions-dashboard">
      <button class="secondary-btn" aria-label="Run Gap Report" onclick="sendCommand('quickGapReport')"><span class="codicon codicon-graph"></span> Gap Report</button>
      <button class="secondary-btn" aria-label="Run Chunk Stats" onclick="sendCommand('quickChunkStats')"><span class="codicon codicon-graph-line"></span> Chunk Stats</button>
      <button class="secondary-btn" aria-label="Go to Pattern Search tab" onclick="switchTab('patternSearch')"><span class="codicon codicon-list-filter"></span> Pattern Search</button>
      <button class="secondary-btn" aria-label="Go to Similar Lines tab" onclick="switchTab('similarLines')"><span class="codicon codicon-group-by-ref-type"></span> Similar Lines</button>
      <button class="secondary-btn" aria-label="Go to Timeline tab" onclick="switchTab('timeline')"><span class="codicon codicon-graph-line"></span> Timeline</button>
    </div>

    <h2>Recent Activity</h2>
    <div class="recent-activity" id="recentActivity">
      <em>No recent activity</em>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- Tab 2: Log Search                                              -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="logSearchTab" role="tabpanel" aria-labelledby="tab-logSearch">
    <h1><span class="codicon codicon-search"></span> Log Search</h1>

    <div class="info-box"><span class="codicon codicon-info"></span> Search is performed on the currently open file in the editor</div>

    <!-- Search Criteria Section -->
    <div class="section" id="searchCriteriaSection">
      <div class="section-header" role="button" tabindex="0" aria-expanded="true" aria-controls="searchCriteriaSectionContent" onclick="toggleSection('searchCriteriaSection')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleSection('searchCriteriaSection')}">
        <span class="section-title"><span class="codicon codicon-target"></span> Search Criteria</span>
        <span class="section-toggle">‚ñº</span>
      </div>
      <div class="section-content" id="searchCriteriaSectionContent">
        <div class="date-time-group">
          <div class="form-group">
            <label for="searchDate">Date</label>
            <input type="date" id="searchDate" aria-label="Search date">
          </div>
          <div class="form-group">
            <label for="searchTime">Time</label>
            <input type="time" id="searchTime" step="1" aria-label="Search time">
          </div>
        </div>
        <div class="quick-actions">
          <button class="quick-action-btn" aria-label="Set date to today" onclick="setToday()"><span class="codicon codicon-calendar"></span> Today</button>
          <button class="quick-action-btn" aria-label="Set time to now" onclick="setNow()"><span class="codicon codicon-clock"></span> Now</button>
          <button class="quick-action-btn" aria-label="Clear date and time" onclick="clearDateTime()"><span class="codicon codicon-close"></span> Clear</button>
        </div>
      </div>
    </div>

    <div class="actions">
      <div class="primary-action">
        <button id="searchButton" aria-label="Navigate to date and time">
          <span class="codicon codicon-search"></span> Navigate to Date &amp; Time
        </button>
      </div>
      <div id="statusMessageLogSearch" class="status-message" role="status" aria-live="polite" aria-atomic="true"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- Tab 3: Pattern Search                                          -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="patternSearchTab" role="tabpanel" aria-labelledby="tab-patternSearch">
    <h1><span class="codicon codicon-list-filter"></span> Pattern Search</h1>

    <div class="section" id="patternConfigSection">
      <div class="section-header" role="button" tabindex="0" aria-expanded="true" aria-controls="patternConfigSectionContent" onclick="toggleSection('patternConfigSection')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleSection('patternConfigSection')}">
        <span class="section-title"><span class="codicon codicon-settings-gear"></span> File Configuration</span>
        <span class="section-toggle">‚ñº</span>
      </div>
      <div class="section-content" id="patternConfigSectionContent">
        <div class="form-group">
          <label for="logFilePath">
            Log File Path
            <span class="help-icon" role="button" tabindex="0" aria-expanded="false" aria-controls="logFileHelp" aria-label="Help for Log File Path" onclick="toggleHelp('logFileHelp', event)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleHelp('logFileHelp',event)}"><span class="codicon codicon-question"></span></span>
          </label>
          <div id="logFileHelp" class="help-text" role="note">Path to the log file you want to search.</div>
          <div class="input-group">
            <input type="text" id="logFilePath" placeholder="e.g., C:\logs\application.log" aria-label="Log file path">
            <button class="browse-btn" aria-label="Browse for log file" onclick="browseFile('log')"><span class="codicon codicon-folder-opened"></span> Browse</button>
          </div>
        </div>

        <div class="form-group">
          <label for="searchPatternsFilePath">
            Pattern File Path (JSON)
            <span class="help-icon" role="button" tabindex="0" aria-expanded="false" aria-controls="patternsFileHelp" aria-label="Help for Pattern File Path" onclick="toggleHelp('patternsFileHelp', event)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleHelp('patternsFileHelp',event)}"><span class="codicon codicon-question"></span></span>
          </label>
          <div id="patternsFileHelp" class="help-text" role="note">Path to JSON file containing search patterns with key, regexp, and regexpoptions fields.</div>
          <div class="input-group">
            <input type="text" id="searchPatternsFilePath" placeholder="e.g., C:\patterns\search-patterns.json" aria-label="Patterns file path">
            <button class="browse-btn" aria-label="Browse for patterns file" onclick="browseFile('patterns')"><span class="codicon codicon-folder-opened"></span> Browse</button>
          </div>
        </div>
      </div>
    </div>

    <div class="section" id="patternTimestampSection">
      <div class="section-header" role="button" tabindex="0" aria-expanded="true" aria-controls="patternTimestampSectionContent" onclick="toggleSection('patternTimestampSection')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleSection('patternTimestampSection')}">
        <span class="section-title"><span class="codicon codicon-settings-gear"></span> Timestamp Format (Optional)</span>
        <span class="section-toggle">‚ñº</span>
      </div>
      <div class="section-content" id="patternTimestampSectionContent">
        <div class="form-group">
          <button id="autoDetectButtonPatternSearch" class="secondary-btn" aria-label="Auto-detect timestamp format">
            <span class="codicon codicon-lightbulb-autofix"></span> Auto-Detect Timestamp Format
          </button>
          <div id="autoDetectStatusPatternSearch" class="status-message" role="status" aria-live="polite" aria-atomic="true"></div>
        </div>
      </div>
    </div>

    <div class="actions">
      <div class="primary-action">
        <button id="searchPatternsButton" aria-label="Search log file for patterns">
          <span class="codicon codicon-search"></span> Search Patterns
        </button>
      </div>
      <div id="statusMessagePatternSearch" class="status-message" role="status" aria-live="polite" aria-atomic="true"></div>
    </div>

    <div class="result-info">
      <div class="result-info-title"><span class="codicon codicon-list-filter"></span> Results Display</div>
      <div class="result-info-text">Search results will open in a new editor tab with detailed pattern match information.</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- Tab 4: Similar Lines                                           -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="similarLinesTab" role="tabpanel" aria-labelledby="tab-similarLines">
    <h1><span class="codicon codicon-group-by-ref-type"></span> Similar Lines Analysis</h1>

    <div class="info-box"><span class="codicon codicon-info"></span> Analyzes the currently open file in the editor to find and count similar log lines</div>

    <div class="actions">
      <div class="primary-action">
        <button id="calculateSimilarLineCountsButton" aria-label="Calculate similar line counts">
          <span class="codicon codicon-group-by-ref-type"></span> Calculate Similar Lines
        </button>
      </div>
      <div id="statusMessageSimilarLines" class="status-message" role="status" aria-live="polite" aria-atomic="true"></div>
    </div>

    <div class="result-info">
      <div class="result-info-title"><span class="codicon codicon-list-filter"></span> Results Display</div>
      <div class="result-info-text">Results will open in a new editor tab showing similar line patterns grouped together with their occurrence counts.</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- Tab 5: Timeline                                                -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="timelineTab" role="tabpanel" aria-labelledby="tab-timeline">
    <h1><span class="codicon codicon-graph-line"></span> Log Timeline</h1>

    <div class="info-box"><span class="codicon codicon-info"></span> Generates a visual timeline of the currently open log file in the editor</div>

    <div class="actions">
      <div class="primary-action">
        <button id="drawLogTimelineButton" aria-label="Draw log timeline">
          <span class="codicon codicon-graph-line"></span> Draw Timeline
        </button>
      </div>
      <div id="statusMessageTimeline" class="status-message" role="status" aria-live="polite" aria-atomic="true"></div>
    </div>

    <div class="result-info">
      <div class="result-info-title"><span class="codicon codicon-list-filter"></span> Results Display</div>
      <div class="result-info-text">Timeline will open in a new editor tab showing a visual representation of log entries over time.</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- Tab 6: File Info                                               -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="fileInfoTab" role="tabpanel" aria-labelledby="tab-fileInfo">
    <h1><span class="codicon codicon-info"></span> File Information</h1>

    <div id="fileInfoPlaceholder">
      <div class="empty-state">
        <div class="empty-state-icon"><span class="codicon codicon-folder-opened" style="font-size: 36px;"></span></div>
        <div class="empty-state-text">Select a file in the Log Files tree or use Dashboard to view file information</div>
      </div>
    </div>

    <div id="fileInfoDetails" style="display: none;">
      <div class="section">
        <h2><span class="codicon codicon-file-text"></span> File Details</h2>
        <table class="file-info-table">
          <tr>
            <td>File Name</td>
            <td id="infoFileName">‚Äî</td>
          </tr>
          <tr>
            <td>File Path</td>
            <td id="infoFilePath">‚Äî</td>
          </tr>
          <tr>
            <td>File Size</td>
            <td id="infoFileSize">‚Äî</td>
          </tr>
          <tr>
            <td>Total Lines</td>
            <td id="infoTotalLines">‚Äî</td>
          </tr>
          <tr>
            <td>Timestamp</td>
            <td id="infoTimestampDetected">‚Äî</td>
          </tr>
          <tr>
            <td>Pattern</td>
            <td id="infoTimestampPattern" style="font-family: monospace; font-size: 11px;">‚Äî</td>
          </tr>
          <tr>
            <td>Format</td>
            <td id="infoFormatDisplay">‚Äî</td>
          </tr>
          <tr>
            <td>Created</td>
            <td id="infoCreatedDate">‚Äî</td>
          </tr>
          <tr>
            <td>Modified</td>
            <td id="infoModifiedDate">‚Äî</td>
          </tr>
          <tr>
            <td>Accessed</td>
            <td id="infoAccessedDate">‚Äî</td>
          </tr>
        </table>
      </div>

      <div class="action-buttons-row">
        <button id="openFileButton" aria-label="Open file in editor">
          <span class="codicon codicon-folder-opened"></span> Open File
        </button>
        <button id="revealInExplorerButton" class="secondary-btn" aria-label="Reveal file in explorer">
          <span class="codicon codicon-go-to-file"></span> Reveal in Explorer
        </button>
      </div>

      <div style="margin-top: 8px;">
        <button id="refreshFileInfoButton" class="secondary-btn" aria-label="Refresh file information">
          <span class="codicon codicon-refresh"></span> Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- Tab 7: Compare Chunk Stats                                     -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="compareChunkStatsTab" role="tabpanel" aria-labelledby="tab-compareChunkStats">
    <h1><span class="codicon codicon-diff"></span> Compare Chunk Stats</h1>

    <div class="info-box"><span class="codicon codicon-info"></span> Compare chunk statistics across multiple log files (minimum 2 files required)</div>

    <div class="section">
      <h2>Selected Files</h2>
      <div class="file-chips" id="compareFileChips">
        <span class="empty-chips">No files selected ‚Äî use buttons below to add files</span>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px;">
        <button class="secondary-btn" aria-label="Add files to compare via file browser" onclick="sendCommand('browseFiles')">
          <span class="codicon codicon-folder-opened"></span> Add Files
        </button>
        <button class="secondary-btn" aria-label="Add files to compare from tree view" onclick="sendCommand('addTreeFiles')">
          <span class="codicon codicon-list-tree"></span> Add from Tree
        </button>
      </div>
    </div>

    <div class="actions">
      <div class="primary-action">
        <button id="compareChunkStatsButton" aria-label="Compare chunk statistics" disabled>
          <span class="codicon codicon-diff"></span> Compare
        </button>
      </div>
      <div id="statusMessageCompareChunkStats" class="status-message" role="status" aria-live="polite" aria-atomic="true"></div>
    </div>

    <div class="result-info">
      <div class="result-info-title"><span class="codicon codicon-list-filter"></span> Results Display</div>
      <div class="result-info-text">Comparison results will open in a separate editor tab with full table and chart visualizations.</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- Tab 8: JSONL Conversion                                        -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="jsonlConversionTab" role="tabpanel" aria-labelledby="tab-jsonlConversion">
    <h1><span class="codicon codicon-arrow-swap"></span> JSONL Conversion</h1>

    <!-- Direction Toggle -->
    <div class="toggle-group">
      <button class="toggle-btn active" data-direction="logToJsonl" aria-label="Convert Log to JSONL" onclick="setConversionDirection('logToJsonl')">
        Log ‚Üí JSONL
      </button>
      <button class="toggle-btn" data-direction="jsonlToLog" aria-label="Convert JSONL to Log" onclick="setConversionDirection('jsonlToLog')">
        JSONL ‚Üí Log
      </button>
    </div>

    <!-- Log ‚Üí JSONL Section -->
    <div class="conversion-section active" id="logToJsonlSection">
      <div class="section">
        <h2><span class="codicon codicon-file-text"></span> Source File</h2>
        <div class="form-group">
          <label>Active File</label>
          <div id="jsonlActiveFile" style="font-size: 12px; color: var(--vscode-descriptionForeground); padding: 6px 8px; background: var(--vscode-input-background); border-radius: 3px; word-break: break-all;">
            No active file ‚Äî open a log file in the editor
          </div>
        </div>
      </div>

      <div class="section">
        <h2><span class="codicon codicon-settings-gear"></span> Settings</h2>
        <div class="form-group">
          <label for="messageMode">Message Mode</label>
          <select id="messageMode">
            <option value="firstLineMinusTimestamp">First Line Minus Timestamp</option>
            <option value="firstLineAsIs">First Line As Is</option>
          </select>
        </div>

        <div class="form-group">
          <label for="maxMultilineSize">Max Multiline Size</label>
          <input type="number" id="maxMultilineSize" value="1000" min="1" max="100000" aria-label="Maximum multiline size">
        </div>

        <label class="checkbox-label">
          <input type="checkbox" id="openInNewEditor" checked>
          Open in New Editor
        </label>
      </div>

      <div class="actions">
        <div class="primary-action">
          <button id="convertToJsonlButton" aria-label="Convert to JSONL">
            <span class="codicon codicon-arrow-swap"></span> Convert to JSONL
          </button>
        </div>
        <div id="statusMessageLogToJsonl" class="status-message" role="status" aria-live="polite" aria-atomic="true"></div>
      </div>
    </div>

    <!-- JSONL ‚Üí Log Section -->
    <div class="conversion-section" id="jsonlToLogSection">
      <div class="section">
        <h2><span class="codicon codicon-file-text"></span> Source JSONL File</h2>
        <div class="form-group">
          <label for="jsonlFilePath">JSONL File Path</label>
          <div class="input-group">
            <input type="text" id="jsonlFilePath" placeholder="e.g., C:\logs\output.jsonl" aria-label="JSONL file path">
            <button class="browse-btn" aria-label="Browse for JSONL file" onclick="browseFile('jsonl')"><span class="codicon codicon-folder-opened"></span> Browse</button>
          </div>
        </div>
      </div>

      <div class="actions">
        <div class="primary-action">
          <button id="convertJsonlToLogButton" aria-label="Convert JSONL to Log">
            <span class="codicon codicon-arrow-swap"></span> Convert to Log
          </button>
        </div>
        <div id="statusMessageJsonlToLog" class="status-message" role="status" aria-live="polite" aria-atomic="true"></div>
      </div>
    </div>
  </div>
  </main>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- JavaScript                                                     -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
    const vscode = acquireVsCodeApi();
    let isProcessing = false;
    let operationTimeout = null;

    // ‚îÄ‚îÄ Recent Activity ‚îÄ‚îÄ
    const MAX_ACTIVITY = 5;
    let recentActivity = [];

    function addActivity(label) {
      recentActivity.unshift({ label, time: new Date().toLocaleTimeString() });
      if (recentActivity.length > MAX_ACTIVITY) recentActivity.length = MAX_ACTIVITY;
      renderRecentActivity();
      saveState();
    }

    function renderRecentActivity() {
      const el = document.getElementById('recentActivity');
      if (!el) return;
      if (recentActivity.length === 0) {
        el.innerHTML = '<em>No recent activity</em>';
        return;
      }
      el.innerHTML = recentActivity
        .map(a => '<div class="activity-item">' + escHtml(a.time) + ' ‚Äî ' + escHtml(a.label) + '</div>')
        .join('');
    }

    // ‚îÄ‚îÄ Operation timeout guard ‚îÄ‚îÄ
    function startOperationTimeout(ms) {
      clearOperationTimeout();
      operationTimeout = setTimeout(() => {
        isProcessing = false;
        document.querySelectorAll('button[disabled]').forEach(btn => {
          if (btn.dataset.orig) setButtonLoading(btn, false);
        });
        showStatusMsg('statusMessagePatternSearch', 'Operation timed out', 'error');
        showStatusMsg('statusMessageSimilarLines', 'Operation timed out', 'error');
        showStatusMsg('statusMessageTimeline', 'Operation timed out', 'error');
        showStatusMsg('statusMessageLogSearch', 'Operation timed out', 'error');
      }, ms || 120000);
    }

    function clearOperationTimeout() {
      if (operationTimeout) { clearTimeout(operationTimeout); operationTimeout = null; }
    }

    // ‚îÄ‚îÄ Compare Stats file list ‚îÄ‚îÄ
    let compareFiles = [];

    // ‚îÄ‚îÄ Current file info URI ‚îÄ‚îÄ
    let currentFileUri = null;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // State Persistence
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function saveState() {
      const state = {
        activeTab: document.querySelector('.tab-button.active')?.dataset.tab || 'dashboard',
        logTimeRegex: gv('logTimeRegex'),
        logTimeFormat: gv('logTimeFormat'),
        searchDate: gv('searchDate'),
        searchTime: gv('searchTime'),
        logFilePath: gv('logFilePath'),
        searchPatternsFilePath: gv('searchPatternsFilePath'),
        compareFiles: compareFiles,
        conversionDirection: document.querySelector('.toggle-btn.active')?.dataset.direction || 'logToJsonl',
        messageMode: gv('messageMode'),
        maxMultilineSize: gv('maxMultilineSize'),
        openInNewEditor: document.getElementById('openInNewEditor')?.checked ?? true,
        jsonlFilePath: gv('jsonlFilePath'),
        recentActivity: recentActivity
      };
      vscode.setState(state);
    }

    function restoreState() {
      const state = vscode.getState();
      if (!state) return;

      if (state.activeTab) switchTab(state.activeTab, true);
      // Backward compatibility: migrate per-tab regex/format to shared fields
      const regex = state.logTimeRegex || state.similarLinesLogTimeRegex || state.timelineLogTimeRegex || '';
      const format = state.logTimeFormat || state.similarLinesLogTimeFormat || state.timelineLogTimeFormat || '';
      if (regex) sv('logTimeRegex', regex);
      if (format) sv('logTimeFormat', format);
      if (state.searchDate) sv('searchDate', state.searchDate);
      if (state.searchTime) sv('searchTime', state.searchTime);
      if (state.logFilePath) sv('logFilePath', state.logFilePath);
      if (state.searchPatternsFilePath) sv('searchPatternsFilePath', state.searchPatternsFilePath);
      if (state.compareFiles) {
        compareFiles = state.compareFiles;
        renderCompareFiles();
      }
      if (state.conversionDirection) setConversionDirection(state.conversionDirection);
      if (state.messageMode) sv('messageMode', state.messageMode);
      if (state.maxMultilineSize) sv('maxMultilineSize', state.maxMultilineSize);
      if (state.openInNewEditor !== undefined) {
        document.getElementById('openInNewEditor').checked = state.openInNewEditor;
      }
      if (state.jsonlFilePath) sv('jsonlFilePath', state.jsonlFilePath);
      if (state.recentActivity) {
        recentActivity = state.recentActivity;
        renderRecentActivity();
      }
    }

    // Short helpers for get/set value
    function gv(id) { const el = document.getElementById(id); return el ? el.value : ''; }
    function sv(id, val) { const el = document.getElementById(id); if (el) el.value = val; }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Tab Switching
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function switchTab(tabName, skipSave) {
      document.querySelectorAll('.tab-button').forEach(btn => {
        const isActive = btn.dataset.tab === tabName;
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
        btn.setAttribute('tabindex', isActive ? '0' : '-1');
      });

      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

      const tabMap = {
        dashboard: 'dashboardTab',
        logSearch: 'logSearchTab',
        patternSearch: 'patternSearchTab',
        similarLines: 'similarLinesTab',
        timeline: 'timelineTab',
        fileInfo: 'fileInfoTab',
        compareChunkStats: 'compareChunkStatsTab',
        jsonlConversion: 'jsonlConversionTab'
      };

      const target = tabMap[tabName];
      if (target) document.getElementById(target).classList.add('active');

      // Show/hide shared format config for tabs that need it
      const formatTabs = ['logSearch', 'similarLines', 'timeline'];
      const formatConfig = document.getElementById('sharedFormatConfig');
      formatConfig.style.display = formatTabs.includes(tabName) ? 'block' : 'none';

      // Scroll the active tab button into view
      const activeBtn = document.querySelector(`.tab-button[data-tab="${tabName}"]`);
      if (activeBtn) activeBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' });

      if (!skipSave) saveState();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Section Collapse
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function toggleSection(id) {
      const section = document.getElementById(id);
      const isCollapsed = section.classList.toggle('collapsed');
      const header = section.querySelector('.section-header');
      if (header) {
        header.setAttribute('aria-expanded', !isCollapsed ? 'true' : 'false');
      }
    }

    function toggleHelp(id, event) {
      if (event) event.stopPropagation();
      const el = document.getElementById(id);
      const isVisible = el.classList.toggle('visible');
      const trigger = document.querySelector('[aria-controls="' + id + '"]');
      if (trigger) {
        trigger.setAttribute('aria-expanded', isVisible ? 'true' : 'false');
      }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Status / Feedback Helpers
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function showStatusMsg(elementId, msg, type, duration) {
      duration = duration || 4000;
      const el = document.getElementById(elementId);
      if (!el) return;
      el.textContent = msg;
      el.className = 'status-message visible ' + type;
      setTimeout(() => el.classList.remove('visible'), duration);
    }

    function setButtonLoading(btn, loading) {
      if (!btn) return;
      if (loading) {
        btn.disabled = true;
        btn.dataset.orig = btn.innerHTML;
        btn.innerHTML = '<span class="spinner"></span> Processing\u2026';
      } else {
        btn.disabled = false;
        if (btn.dataset.orig) btn.innerHTML = btn.dataset.orig;
      }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Shared ‚Äî Regex / Format helpers
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function getRegexFormat() {
      return { regex: gv('logTimeRegex'), format: gv('logTimeFormat') };
    }

    function testRegex() {
      const vals = getRegexFormat();
      if (!vals.regex) { showStatusMsg('regexTestResult', 'Please enter a regex pattern', 'error', 5000); return; }
      if (!vals.format) { showStatusMsg('regexTestResult', 'Please enter a format string', 'error', 5000); return; }
      vscode.postMessage({ command: 'testRegex', logTimeRegex: vals.regex, logTimeFormat: vals.format });
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Log Search Helpers
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function setToday() {
      document.getElementById('searchDate').value = new Date().toISOString().split('T')[0];
      saveState();
    }

    function setNow() {
      document.getElementById('searchTime').value = new Date().toTimeString().split(' ')[0];
      saveState();
    }

    function clearDateTime() {
      document.getElementById('searchDate').value = '';
      document.getElementById('searchTime').value = '';
      saveState();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Browse File
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function browseFile(fileType) {
      vscode.postMessage({ command: 'browseFile', fileType: fileType });
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Simple command sender
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function sendCommand(cmd) {
      vscode.postMessage({ command: cmd });
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Compare Chunk Stats ‚Äî file list management
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function renderCompareFiles() {
      const container = document.getElementById('compareFileChips');
      const btn = document.getElementById('compareChunkStatsButton');

      if (compareFiles.length === 0) {
        container.innerHTML = '<span class="empty-chips">No files selected \u2014 use buttons below to add files</span>';
        btn.disabled = true;
        return;
      }

      container.innerHTML = compareFiles.map((f, i) =>
        '<span class="file-chip" title="' + escHtml(f.path) + '">' +
          '<span class="file-chip-name">' + escHtml(f.name) + '</span>' +
          '<span class="file-chip-remove" role="button" tabindex="0" aria-label="Remove ' + escHtml(f.name) + '" onclick="removeCompareFile(' + i + ')" onkeydown="if(event.key===\'Enter\'||event.key===\' \'){event.preventDefault();removeCompareFile(' + i + ')}">&times;</span>' +
        '</span>'
      ).join('');

      btn.disabled = compareFiles.length < 2;
    }

    function removeCompareFile(index) {
      compareFiles.splice(index, 1);
      renderCompareFiles();
      saveState();
    }

    function addCompareFiles(files) {
      const existing = new Set(compareFiles.map(f => f.path));
      for (const f of files) {
        if (!existing.has(f.path)) {
          compareFiles.push(f);
          existing.add(f.path);
        }
      }
      renderCompareFiles();
      saveState();
    }

    function escHtml(str) {
      const d = document.createElement('div');
      d.textContent = str;
      return d.innerHTML;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // JSONL Conversion ‚Äî direction toggle
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function setConversionDirection(dir) {
      document.querySelectorAll('.toggle-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.direction === dir);
      });
      document.getElementById('logToJsonlSection').classList.toggle('active', dir === 'logToJsonl');
      document.getElementById('jsonlToLogSection').classList.toggle('active', dir === 'jsonlToLog');
      saveState();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Dashboard update helpers
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function updateDashboardActiveFile(data) {
      const headerEl = document.getElementById('headerActiveFile');
      const dashEl = document.getElementById('dashboardActiveFile');
      const jsonlEl = document.getElementById('jsonlActiveFile');
      const largeWarnEl = document.getElementById('largeFileWarning');

      if (data && data.fileName) {
        headerEl.textContent = data.fileName;
        dashEl.textContent = data.filePath || data.fileName;
        jsonlEl.textContent = data.filePath || data.fileName;

        // Stats cards
        document.getElementById('dashFileSize').textContent = data.fileSize || '‚Äî';
        document.getElementById('dashLineCount').textContent =
          data.lineCount !== undefined ? Number(data.lineCount).toLocaleString() : '‚Äî';

        const tsEl = document.getElementById('dashTimestamp');
        if (data.timestampDetected) {
          tsEl.innerHTML = '<span class="dot dot-green"></span> ' + escHtml(data.timestampFormat || 'Detected');
        } else {
          tsEl.innerHTML = '<span class="dot dot-red"></span> None';
        }

        // Large file warning
        largeWarnEl.style.display = data.largeFile ? 'block' : 'none';
      } else {
        headerEl.textContent = 'No active file';
        dashEl.textContent = 'No active file';
        jsonlEl.textContent = 'No active file \u2014 open a log file in the editor';
        document.getElementById('dashFileSize').textContent = '‚Äî';
        document.getElementById('dashLineCount').textContent = '‚Äî';
        document.getElementById('dashTimestamp').innerHTML = '<span class="dot dot-red"></span> None';
        largeWarnEl.style.display = 'none';
      }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Incoming Message Handler
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    window.addEventListener('message', event => {
      const msg = event.data;

      switch (msg.command) {

        // ‚îÄ‚îÄ setValues ‚îÄ‚îÄ
        case 'setValues':
          if (msg.logTimeRegex !== undefined) {
            sv('logTimeRegex', msg.logTimeRegex);
          }
          if (msg.logTimeFormat !== undefined) {
            sv('logTimeFormat', msg.logTimeFormat);
          }
          if (msg.searchDate !== undefined) sv('searchDate', msg.searchDate);
          if (msg.searchTime !== undefined) sv('searchTime', msg.searchTime);
          if (msg.logFilePath !== undefined) sv('logFilePath', msg.logFilePath);
          if (msg.searchPatternsFilePath !== undefined) sv('searchPatternsFilePath', msg.searchPatternsFilePath);
          saveState();
          break;

        // ‚îÄ‚îÄ updateActiveFile ‚îÄ‚îÄ
        case 'updateActiveFile':
          updateDashboardActiveFile(msg);
          break;

        // ‚îÄ‚îÄ clearActiveFile ‚îÄ‚îÄ
        case 'clearActiveFile':
          updateDashboardActiveFile(null);
          break;

        // ‚îÄ‚îÄ operationComplete ‚îÄ‚îÄ
        case 'operationComplete': {
          isProcessing = false;
          clearOperationTimeout();
          // Reset ALL loading buttons
          document.querySelectorAll('button[disabled]').forEach(btn => {
            if (btn.dataset.orig) setButtonLoading(btn, false);
          });

          const type = msg.success ? 'success' : 'error';
          const text = msg.message || (msg.success ? 'Done' : 'Failed');

          if (msg.success && msg.message) {
            addActivity(msg.message);
          }

          // Show on all relevant status areas
          ['statusMessageLogSearch', 'statusMessagePatternSearch', 'statusMessageSimilarLines',
           'statusMessageTimeline', 'statusMessageCompareChunkStats',
           'statusMessageLogToJsonl', 'statusMessageJsonlToLog'].forEach(id => {
            showStatusMsg(id, text, type);
          });
          break;
        }

        // ‚îÄ‚îÄ testRegexResult ‚îÄ‚îÄ
        case 'testRegexResult': {
          const rType = msg.success ? 'success' : 'error';
          showStatusMsg('regexTestResult', msg.message, rType, 5000);
          break;
        }

        // ‚îÄ‚îÄ timestampFormatDetected ‚îÄ‚îÄ
        case 'timestampFormatDetected': {
          // Determine which auto-detect button/status to update
          const tabKey = msg.tab || 'logSearch';
          const isPatternSearch = tabKey === 'patternSearch';

          // Reset the appropriate button
          if (isPatternSearch) {
            setButtonLoading(document.getElementById('autoDetectButtonPatternSearch'), false);
          } else {
            setButtonLoading(document.getElementById('autoDetectButton'), false);
          }

          const statusElId = isPatternSearch ? 'autoDetectStatusPatternSearch' : 'autoDetectStatus';
          const statusEl = document.getElementById(statusElId);

          if (msg.success && msg.detected) {
            if (!isPatternSearch) {
              sv('logTimeRegex', msg.regex);
              sv('logTimeFormat', msg.format);
              saveState();
            }
            statusEl.innerHTML = msg.message + '<br><small>Pattern: ' + escHtml(msg.pattern || '') +
              ' | Lines: ' + (msg.totalLines !== undefined ? msg.totalLines.toLocaleString() : '?') + '</small>';
            statusEl.className = 'status-message visible success';
          } else {
            statusEl.textContent = msg.message || 'Auto-detection failed';
            statusEl.className = 'status-message visible error';
          }
          setTimeout(() => statusEl.classList.remove('visible'), 5000);
          break;
        }

        // ‚îÄ‚îÄ setFilePath ‚îÄ‚îÄ
        case 'setFilePath':
          if (msg.fileType === 'log') sv('logFilePath', msg.path);
          else if (msg.fileType === 'patterns') sv('searchPatternsFilePath', msg.path);
          else if (msg.fileType === 'jsonl') sv('jsonlFilePath', msg.path);
          saveState();
          break;

        // ‚îÄ‚îÄ showFileInfo ‚îÄ‚îÄ
        case 'showFileInfo':
          document.getElementById('fileInfoPlaceholder').style.display = 'none';
          document.getElementById('fileInfoDetails').style.display = 'block';

          document.getElementById('infoFileName').textContent = msg.fileName || '‚Äî';
          document.getElementById('infoFilePath').textContent = msg.filePath || '‚Äî';
          document.getElementById('infoFileSize').textContent = msg.fileSize || '‚Äî';
          document.getElementById('infoTotalLines').textContent =
            msg.totalLines !== undefined ? Number(msg.totalLines).toLocaleString() : '‚Äî';

          const tsEl = document.getElementById('infoTimestampDetected');
          if (msg.timestampDetected !== undefined) {
            const iconClass = msg.timestampDetected ? 'status-icon-pass' : 'status-icon-fail';
            const iconName = msg.timestampDetected ? 'codicon-pass-filled' : 'codicon-error';
            const label = msg.timestampDetected ? 'Yes' : 'No';
            tsEl.innerHTML = '<span class="codicon ' + iconName + ' ' + iconClass + '"></span> ' + label;
          } else {
            tsEl.textContent = '‚Äî';
          }

          document.getElementById('infoTimestampPattern').textContent = msg.timestampPattern || '‚Äî';
          document.getElementById('infoFormatDisplay').textContent = msg.formatDisplay || '‚Äî';
          document.getElementById('infoCreatedDate').textContent = msg.createdDate || '‚Äî';
          document.getElementById('infoModifiedDate').textContent = msg.modifiedDate || '‚Äî';
          document.getElementById('infoAccessedDate').textContent = msg.accessedDate || '‚Äî';

          currentFileUri = msg.fileUri || null;
          break;

        // ‚îÄ‚îÄ switchTab ‚îÄ‚îÄ
        case 'switchTab':
          if (msg.tabName) switchTab(msg.tabName);
          break;

        // ‚îÄ‚îÄ setTreeFiles ‚îÄ‚îÄ
        case 'setTreeFiles':
          if (Array.isArray(msg.files)) {
            addCompareFiles(msg.files);
          }
          break;
      }
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Event Listeners ‚Äî Preset Selects
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // Log Format presets (shared)
    document.getElementById('logTimeRegexSelect').addEventListener('change', e => {
      if (e.target.value) { sv('logTimeRegex', e.target.value); saveState(); }
    });
    document.getElementById('logTimeFormatSelect').addEventListener('change', e => {
      if (e.target.value) { sv('logTimeFormat', e.target.value); saveState(); }
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Event Listeners ‚Äî Auto-Detect Buttons
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // Shared auto-detect button (for logSearch, similarLines, timeline)
    document.getElementById('autoDetectButton').addEventListener('click', () => {
      setButtonLoading(document.getElementById('autoDetectButton'), true);
      vscode.postMessage({ command: 'autoDetectTimestampFormat', tab: 'logSearch' });
    });

    // Pattern Search has its own separate auto-detect
    document.getElementById('autoDetectButtonPatternSearch').addEventListener('click', () => {
      setButtonLoading(document.getElementById('autoDetectButtonPatternSearch'), true);
      vscode.postMessage({ command: 'autoDetectTimestampFormat', tab: 'patternSearch' });
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Event Listeners ‚Äî Primary Action Buttons
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // Log Search ‚Äî Navigate
    document.getElementById('searchButton').addEventListener('click', () => {
      const vals = getRegexFormat();
      if (!vals.regex) { showStatusMsg('statusMessageLogSearch', 'Please enter a date/time regex pattern', 'error'); return; }
      if (!vals.format) { showStatusMsg('statusMessageLogSearch', 'Please enter a date/time format string', 'error'); return; }
      if (isProcessing) return;
      isProcessing = true;
      startOperationTimeout();
      setButtonLoading(document.getElementById('searchButton'), true);
      vscode.postMessage({
        command: 'search',
        logTimeRegex: vals.regex,
        logTimeFormat: vals.format,
        searchDate: gv('searchDate'),
        searchTime: gv('searchTime')
      });
    });

    // Pattern Search
    document.getElementById('searchPatternsButton').addEventListener('click', () => {
      const logFilePath = gv('logFilePath');
      const searchPatternsFilePath = gv('searchPatternsFilePath');
      if (!logFilePath) { showStatusMsg('statusMessagePatternSearch', 'Please enter a log file path', 'error'); return; }
      if (!searchPatternsFilePath) { showStatusMsg('statusMessagePatternSearch', 'Please enter a patterns file path', 'error'); return; }
      if (isProcessing) return;
      isProcessing = true;
      startOperationTimeout();
      setButtonLoading(document.getElementById('searchPatternsButton'), true);
      vscode.postMessage({ command: 'searchPatterns', logFilePath, searchPatternsFilePath });
    });

    // Similar Lines
    document.getElementById('calculateSimilarLineCountsButton').addEventListener('click', () => {
      const vals = getRegexFormat();
      if (!vals.regex || !vals.format) {
        showStatusMsg('statusMessageSimilarLines', 'Please enter regex pattern and format string', 'error');
        return;
      }
      if (isProcessing) return;
      isProcessing = true;
      startOperationTimeout();
      setButtonLoading(document.getElementById('calculateSimilarLineCountsButton'), true);
      vscode.postMessage({ command: 'calculateSimilarLineCounts', logTimeRegex: vals.regex, logTimeFormat: vals.format });
    });

    // Timeline
    document.getElementById('drawLogTimelineButton').addEventListener('click', () => {
      const vals = getRegexFormat();
      if (!vals.regex || !vals.format) {
        showStatusMsg('statusMessageTimeline', 'Please enter regex pattern and format string', 'error');
        return;
      }
      if (isProcessing) return;
      isProcessing = true;
      startOperationTimeout();
      setButtonLoading(document.getElementById('drawLogTimelineButton'), true);
      vscode.postMessage({ command: 'drawLogTimeline', logTimeRegex: vals.regex, logTimeFormat: vals.format });
    });

    // Compare Chunk Stats
    document.getElementById('compareChunkStatsButton').addEventListener('click', () => {
      if (compareFiles.length < 2) {
        showStatusMsg('statusMessageCompareChunkStats', 'Please add at least 2 files to compare', 'error');
        return;
      }
      if (isProcessing) return;
      isProcessing = true;
      startOperationTimeout();
      setButtonLoading(document.getElementById('compareChunkStatsButton'), true);
      vscode.postMessage({ command: 'compareChunkStats', filePaths: compareFiles.map(f => f.path) });
    });

    // Convert to JSONL
    document.getElementById('convertToJsonlButton').addEventListener('click', () => {
      if (isProcessing) return;
      isProcessing = true;
      startOperationTimeout();
      setButtonLoading(document.getElementById('convertToJsonlButton'), true);
      vscode.postMessage({ command: 'convertToJsonl' });
    });

    // Convert JSONL to Log
    document.getElementById('convertJsonlToLogButton').addEventListener('click', () => {
      const filePath = gv('jsonlFilePath');
      if (!filePath) {
        showStatusMsg('statusMessageJsonlToLog', 'Please enter a JSONL file path', 'error');
        return;
      }
      if (isProcessing) return;
      isProcessing = true;
      startOperationTimeout();
      setButtonLoading(document.getElementById('convertJsonlToLogButton'), true);
      vscode.postMessage({ command: 'convertJsonlToLog', filePath });
    });

    // File Info buttons
    document.getElementById('openFileButton').addEventListener('click', () => {
      if (currentFileUri) vscode.postMessage({ command: 'openFile', fileUri: currentFileUri });
    });

    document.getElementById('revealInExplorerButton').addEventListener('click', () => {
      if (currentFileUri) vscode.postMessage({ command: 'revealInExplorer', fileUri: currentFileUri });
    });

    document.getElementById('refreshFileInfoButton').addEventListener('click', () => {
      vscode.postMessage({ command: 'refreshFileInfo' });
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Keyboard Shortcuts
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    document.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey && !e.ctrlKey && !e.altKey && e.target.tagName === 'INPUT') {
        e.preventDefault();
        const active = document.querySelector('.tab-content.active');
        if (!active) return;
        if (active.id === 'logSearchTab') document.getElementById('searchButton').click();
        else if (active.id === 'patternSearchTab') document.getElementById('searchPatternsButton').click();
        else if (active.id === 'similarLinesTab') document.getElementById('calculateSimilarLineCountsButton').click();
        else if (active.id === 'timelineTab') document.getElementById('drawLogTimelineButton').click();
      }
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Save state on input change
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    document.querySelectorAll('input, select').forEach(el => {
      el.addEventListener('change', saveState);
      if (el.tagName === 'INPUT' && el.type === 'text') {
        el.addEventListener('input', saveState);
      }
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Tab Navigation ‚Äî Arrow Keys
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    document.querySelector('.tab-nav').addEventListener('keydown', (e) => {
      const tabs = Array.from(document.querySelectorAll('.tab-button'));
      const currentIndex = tabs.indexOf(document.activeElement);
      if (currentIndex === -1) return;

      let newIndex;
      switch (e.key) {
        case 'ArrowRight':
        case 'ArrowDown':
          newIndex = (currentIndex + 1) % tabs.length;
          break;
        case 'ArrowLeft':
        case 'ArrowUp':
          newIndex = (currentIndex - 1 + tabs.length) % tabs.length;
          break;
        case 'Home':
          newIndex = 0;
          break;
        case 'End':
          newIndex = tabs.length - 1;
          break;
        case 'Enter':
        case ' ':
          e.preventDefault();
          tabs[currentIndex].click();
          return;
        default:
          return;
      }
      e.preventDefault();
      tabs[newIndex].focus();
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Input Validation
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    document.getElementById('logTimeRegex').addEventListener('blur', () => {
      const val = gv('logTimeRegex');
      if (!val) return;
      try {
        new RegExp(val);
        showStatusMsg('regexTestResult', '', 'success', 1);
      } catch (e) {
        showStatusMsg('regexTestResult', 'Invalid regex: ' + e.message, 'error');
      }
    });

    document.getElementById('maxMultilineSize').addEventListener('blur', () => {
      const val = parseInt(gv('maxMultilineSize'), 10);
      if (isNaN(val) || val < 1 || val > 10000) {
        sv('maxMultilineSize', '100');
        showStatusMsg('statusMessageLogToJsonl', 'Max multiline size must be 1‚Äì10000. Reset to 100.', 'error');
      }
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Initialize
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    window.addEventListener('load', () => {
      restoreState();
      // Set today's date if empty
      const d = document.getElementById('searchDate');
      if (!d.value) d.value = new Date().toISOString().split('T')[0];
    });
  </script>
</body>
</html>
